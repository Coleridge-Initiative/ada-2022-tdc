######################### CHECKPOINT 1 #########################
check_1.hint <- function() {
    writeLines("Fill in the blanks with the year-quarters that you would like to include for your analysis. In the previous notebooks, we have used the first 4 quarters after our cohort's exit date ('2018 Q2'). We have provided 4 blanks but you may choose as many or as few quarters as you would like.")
}

check_1.solution <- function() {
    qry_to_disp = paste0("qry <- \"SELECT nb.ssn, nb.tanf_total_months, wr.Empr_no, wr.Wage, wr.yr_quarter
    FROM 
    tr_tdc_2022.dbo.nb_cohort nb
    LEFT JOIN 
    (   select SSN, Empr_no, Year, Quarter, Wage, yr_quarter
        FROM tr_tdc_2022.dbo.wages_tanf
        WHERE yr_quarter IN ('2018 Q3', '2018 Q4', '2019 Q1', '2019 Q2')
        AND (SSN IN (SELECT DISTINCT(SSN) FROM tr_tdc_2022.dbo.nb_cohort))
    ) wr
    ON wr.SSN=nb.SSN;\"")
    writeLines(qry_to_disp)
}

######################### CHECKPOINT 2 #########################
check_2.hint <- function() {
writeLines("This is similar to what we did in the beginner and advanced notebooks for 05_Presentation_Prep_Beginner.ipynb. Here, we would encourage you to go over the rounding rules in addition to going over the code from the aforementioned notebooks.")
}

check_2.solution <- function() {
    qry_to_disp = paste0("cohort_wages3 <- cohort_wages2 %>%
    group_by(tanf_time_cat) %>%  
    mutate(pop = n_distinct(ssn)) %>%
    ungroup() %>%
    group_by(yr_quarter, tanf_time_cat) %>%
    summarise(count = n_distinct(ssn),
               count_round = ifelse(count < 1000, round(count, digits = -1), 
                                   round(count, digits = -2)),
              pop = unique(pop),
              pop_round = ifelse(pop < 1000, round(pop, digits = -1), 
                round(pop, digits = -2)),
             percentage = 100*(count_round/pop_round),
             percentage_round = round(percentage, digits = 0))")
    writeLines(qry_to_disp)
}

######################### CHECKPOINT 3 #########################

check_3.hint <- function() {
    writeLines("
Pick any two colors from the color-blind friendly palette provided at the start of the notebook.
")
}

check_3.solution <- function() {
     qry_to_disp <- "fill_color <- c('Long Time' = '#009E73',
                'Short Time' = '#0072B2')"
    writeLines(qry_to_disp)
}

######################### CHECKPOINT 4 #########################

check_4a.hint <- function() {
    writeLines("As a reminder, the x-axis corresponds to the variable associated with year-quarters. The y-axis corresponds to the rounded percentage of employment. Furthermore, the bar plots will be filled with the categorical variable that tells us if a recipient was on TANF for a long or short time. There are additional blanks that will be filled in using the fill_color vector that was created above. Note that there are also blanks for labelling the x and y axes in addition to the title and caption.")
}

check_4a.solution <- function() {
     qry_to_disp <- "Figure_4a <- cohort_wages4 %>%
    ggplot(aes(x = yr_quarter, 
               y = percentage_round, 
               fill = tanf_time_cat)) +
    geom_bar(stat='identity', position='dodge') +
    expand_limits(y = 0) +
    labs(colour = 'Portion of Employment') + # Chance the title for the legend
    scale_fill_manual('', values = fill_color) +
    labs(
        # Labelling x axis
        x = 'Quarter-Year', 
        # Labelling y axis
        y = 'Percent Employed', 
        # Add a title that conveys the main takeaway of the graph
        title = '', 
        # cite the source of your data
        caption = 'Indiana TANF data (2018Q2 Exiters) \n Indiana UI Wage records'
        )"
    writeLines(qry_to_disp)
}

######################### CHECKPOINT 4 #########################

check_4b.hint <- function() {
    writeLines("As a reminder, the x-axis corresponds to the variable associated with year-quarters. The y-axis corresponds to the rounded percentage of employment. Both the group and color parameters correspond to the categorical variable that identifies if a recipient was on TANF for a long or short time. We have filled in the colors but there are blanks for labelling the x and y axes in addition to the title and caption that we encourage you to update.")
}

check_4b.solution <- function() {
     qry_to_disp <- "Figure_4b <- cohort_wages4 %>%
    ggplot(aes(x = yr_quarter, 
               y = percentage_round, 
               group = tanf_time_cat, 
               color = tanf_time_cat)) +
    geom_line(size = 1.3) + 
    geom_point(size = 5) + 
    expand_limits(y = 0) +
    labs(colour = 'Employment Growth Rate') + # Chance the title for the legend
    scale_color_manual('', values = fill_color) +
    labs(
        # Labelling x axis
        x = 'Year-Quarter', 
        # Labelling y axis
        y = 'Percent Employed', 
        # Add a title that conveys the main takeaway of the graph
        title = '', 
        # cite the source of your data
        caption = 'Indiana TANF data (2018Q2 Exiters) \n Indiana UI Wage records'
        )"
    writeLines(qry_to_disp)
}